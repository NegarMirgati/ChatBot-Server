<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/static/style.css">
  <script src="/static/FarsiType.js"></script>
  <link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css?family=Open+Sans:400,700'>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/static/emojionearea-master/emojionearea-master/dist/emojionearea.min.css" media="screen">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css" media="screen">
  <link rel="stylesheet" type="text/css" href="http://mervick.github.io/lib/google-code-prettify/skins/tomorrow.css" media="screen">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript" src="http://mervick.github.io/lib/google-code-prettify/prettify.js"></script>
  <script type="text/javascript" src="/static/emojionearea-master/emojionearea-master/dist/emojionearea.min.js"></script>
</head>

<body style="background-color: rgb(194, 227, 224);">
  <div id = "myframe">
    <div id="header">
      <h1 id = "title">چت بات</h1>         
    </div>
    <div id="chatbox">
      <div class = "row">
        <div class = "col-xs-3 col-chat">
          <img src="/static/chatbot.jpg" alt="chatbot" id = "bot-avatar">
        </div>
        <div class = "col-xs-9 col-chat">
            <div class=" botText talk-bubble-bot tri-right round left-in" style = "background-color : white;"> 
              <div class="talktext">
                <p class = "botText">سلام من چت بات هستم. بفرمایید</p>
              </div>
            </div>
        </div>
    </div>
    </div>
    <div id="footer">
      <div id="userInput" class="container">
        <div class="clearfix">
            <div class="row">
              <div class="col-6">
                    <input id="textInput" type = "text" name="msg" placeholder="‍‍‍‍‍...پیام خود را بنویسید"/>
              </div>
              <div class="col-6">
                <div id="emoji-container"></div>
              </div>
            </div>
            <div class = "row">
              <div class = "col">
              <span class="input-group-btn">
                <button id="buttonInput" class="btn btn-primary btn-sm"><i class="fa fa-send fa-1x" aria-hidden="true"></i></button>
              </span>
            </div>
          </div>
        </div>
      </div>      
          <script type="text/javascript">
            $(document).ready(function() {
              $("#textInput").emojioneArea({
                container: "#emoji-container",
                hideSource: true,
                useSprite: false
              });
            });
          </script>
          <script>
              var input = document.getElementById("textInput");
              input.addEventListener("keyup", function(event) {
                console.log('here')
                if (event.keyCode === 13) {
                 event.preventDefault();
                 document.getElementById("buttonInput").click();
                }
              });
          </script>
              
    </div>
</div>


    <script>
        function getBotResponse() {
        var rawText = $("#textInput").val();          
        var userHtml = '<div class = "row"><div class = "col-xs-9 col-chat"> <div class="talk-bubble-user tri-right round right-in"> <div class="talktext"> <p class = "userText">' +  rawText + '</p></div></div></div><div class = "col-xs-3 col-chat text-right"> <img src="/static/f1.png" alt="student" class="right" id = "user-avatar"></div></div>' ;
        $("#chatbox").append(userHtml);
        document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
       
        $.get("/get", { msg: rawText }).done(function(data) {
          var str = data;
          var n = str.search("#");
          var res = str.substring(n+1, str.length);
          data = str.substring(0, n);
          var botHtml = '<div class="row"><div class = "col-xs-3 col-chat"> <img src="/static/chatbot.jpg" alt="chatbot" id = "bot-avatar"></div> <div class = "col-xs-9 col-chat"> <div class="talk-bubble-bot tri-right round left-in" style = "background-color : white;"> <div class="talktext"><p class = "botText">' + data + '</p></div></div></div></div>';
          $("#chatbox").append(botHtml);
          $("div.emojionearea-editor").data("emojioneArea").setText('');
          document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
        });
      }
     
      
      $("#textInput").keypress(function chatKeyPressed(e){
        $('.emoji-wysiwyg-editor').html('');
          if(e.which == 13) {
              getBotResponse();
          }
      });
      $("#buttonInput").click(function(){
        getBotResponse();
      })
      
    </script>
  </div>
</div>
</body>
</html>


</html>
